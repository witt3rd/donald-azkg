# Create Note

You are tasked with creating a new atomic note in the Zettelkasten knowledge graph. Follow these steps systematically:

## 1. Parse Input and Check for Duplicates

**Input format:** User provides either:
- A topic name: `/create-note semantic_routing`
- A descriptive phrase: `/create-note "Rust async runtime comparison"`

**Duplicate detection:**
- Search existing notes using Glob for similar filenames
- Search content using Grep for similar concepts
- If potential duplicate found, ask user:
  - "Found existing note `similar_note.md`. Would you like to:
    - Expand/refresh that note instead?
    - Create a new distinct note (explain the difference)?
    - Cancel?"

## 2. Generate Filename

**Naming convention:**
- `topic_specific_concept.md` - lowercase with underscores
- Descriptive, not generic: `python_mcp_sdk.md` NOT `sdk.md`
- No folder prefixes in filename
- All notes go in repository root

**Examples:**
- Input: "semantic routing" → `semantic_routing.md`
- Input: "Rust async runtime comparison" → `rust_async_runtime_comparison.md`
- Input: "First principles thinking" → `first_principles_thinking.md`

## 3. Research the Topic

**Use Perplexity for comprehensive research:**
- Formulate focused query: "Provide comprehensive, technical information about [TOPIC] including: definition, key concepts, how it works, common use cases, best practices, related technologies, and current state as of 2025. Focus on technical accuracy and concrete details."
- Use `mcp__perplexity-ask__perplexity_ask` tool
- Gather sufficient material for complete, self-contained note
- Capture citation sources for references section

**Research depth:**
- Note should be atomic (one concept) but complete
- Include enough context to be standalone
- Technical and specific, not superficial

## 4. Discover Relationships

**Analyze against existing knowledge graph:**

**Prerequisites:** What must be understood first?
- Search for foundational concepts this builds upon
- Check existing notes for topics that should come before this
- Example: `mcp_security.md` requires `mcp_overview.md` first

**Related concepts:** What connects at the same level?
- Find complementary or adjacent topics
- Technologies that integrate or compare
- Example: `semantic_routing.md` relates to `agents.md`

**Extends:** What does this build upon?
- Specific notes this concept directly extends
- Base concepts or patterns this implements
- Example: `python_mcp_sdk.md` extends `mcp_sdk.md`

**Examples:** What concrete implementations exist?
- Look for specific tool/framework notes
- Implementation patterns
- Example: `agents.md` has examples like `alita.md`

**Alternatives:** Different approaches to same problem?
- Competing technologies or patterns
- Different paradigms for same goal

**For each relationship, provide "why" explanation:**
```json
{
  "note": "related_note.md",
  "why": "Clear explanation of why this relationship exists"
}
```

## 5. Generate Tag Recommendations

**Read `tag_system.md` for complete tag catalog**

**Select 3-6 tags across multiple dimensions:**
1. **Technology/Language:** `#python`, `#rust`, `#typescript`, etc.
2. **Framework/Tool:** `#react`, `#mcp`, `#fastmcp`, etc.
3. **Domain/Discipline:** `#agents`, `#llm`, `#security`, etc.
4. **Content Type:** `#api`, `#guide`, `#pattern`, `#reference`, etc.
5. **Cross-cutting Themes:** `#async`, `#optimization`, `#testing`, etc.
6. **Method/Thinking:** `#first-principles`, `#systems-thinking`, etc.

**Tag format:** lowercase with hyphens in YAML array
```yaml
tags: [python, mcp, agents, sdk, api]
```

## 6. Write the Note

**Use Write tool to create the file with this structure:**

```markdown
---
tags: [tag1, tag2, tag3, tag4, tag5]
---
# Note Title

Brief 1-2 sentence summary of the concept.

## Main Content

Complete, self-contained explanation organized into logical sections.

### Section 1: Overview
[Core concept explanation]

### Section 2: How It Works
[Technical details]

### Section 3: Use Cases
[When and why to use this]

### Section 4: Best Practices
[Practical guidance]

## Related Concepts

[This section will be auto-generated by graph sync - leave empty or add placeholder]

## References

[If research provided citations, include them here]
[1] Source URL
[2] Source URL
```

**Content guidelines:**
- Write for LLM context consumption, not just human reading
- Complete enough to stand alone when attached to prompt
- Technical and specific, avoid vague generalities
- No hyperbolic language or marketing claims
- Use wikilinks `[[note]]` to reference existing notes
- Code examples where appropriate
- Concrete, actionable information

## 7. Update Knowledge Graph

**Use .claude/scripts/add_note.py to update graph**

**Note:** The knowledge graph JSON is too large to fit in context window. Use the generic Python scripts in `.claude/scripts/` directory instead of direct manipulation.

**Determine appropriate batch:**
- Review existing batches using `python .claude/scripts/query_graph.py metadata`
- Common batches: Core AI/Agents, MCP Protocol, Python Stack, Rust Stack, TypeScript Stack, Windows Platform, Writing & Strategy
- Place in most semantically appropriate batch
- If unclear, suggest new batch or add to most relevant existing

**Prepare relationships JSON:**
Build a relationships object with discovered relationships:
```json
{
  "prerequisites": [
    {"note": "prereq.md", "why": "explanation"}
  ],
  "related_concepts": [
    {"note": "related.md", "why": "explanation"}
  ],
  "extends": [
    {"note": "base.md", "why": "explanation"}
  ],
  "extended_by": [],
  "alternatives": [
    {"note": "alternative.md", "why": "explanation"}
  ],
  "examples": [
    {"note": "example.md", "why": "explanation"}
  ]
}
```

**Call add_note.py script:**
```bash
python .claude/scripts/add_note.py \
  "new_note.md" \
  "Note Title" \
  "tag1,tag2,tag3" \
  "Brief summary" \
  "Batch Name" \
  '{"prerequisites": [{"note": "other.md", "why": "reason"}], ...}'
```

The script will:
1. Add note entry with metadata
2. Add to specified batch
3. Establish bidirectional relationships automatically
4. Update metadata (increment version, update count, set timestamp)
5. Save graph

**Verify graph integrity:**
After adding, run validation:
```bash
python .claude/scripts/validate_graph.py
```

This ensures all relationships are valid and bidirectional consistency is maintained.

## 8. Update MOC Files

**Identify relevant MOC files:**
- Check tags to determine which MOCs apply
- Common MOCs: `agents_moc.md`, `mcp_moc.md`, `rust_moc.md`, `typescript_moc.md`, `python_moc.md`, `writing_moc.md`

**For each relevant MOC:**
- Read the MOC file
- Find appropriate section to add link
- Add wikilink with brief context: `- [[new_note]] - Brief description`
- Maintain MOC organization and structure
- Use Edit tool for surgical updates

## 9. Provide Summary

**Report to user:**
```
Created new note: `new_note.md`

**Tags:** tag1, tag2, tag3, tag4, tag5

**Relationships established:**
- Prerequisites: 2 notes
- Related concepts: 3 notes
- Extends: 1 note
- Examples: 2 notes

**Knowledge graph updated:**
- Added to Batch N: "Batch Name"
- Version: 16.0 → 17.0
- Total notes: 93 → 94
- Bidirectional links established: 8

**MOCs updated:**
- moc_name_moc.md (added to "Section Name")
- other_moc.md (added to "Other Section")

**Next steps:**
- Review the note at `new_note.md`
- Use `/graph-note new_note.md` to verify graph entry
- Use `/graph-validate` to ensure graph integrity
- Use `/expand-graph new_note.md` to discover additional relationships (if available)
```

## Important Constraints

**Critical rules:**
- NEVER modify "Related Concepts" sections - they're auto-generated
- ALWAYS use wikilink format `[[note]]` not `[[note.md]]`
- MAINTAIN bidirectionality in all relationships
- ENSURE atomicity - one complete, usable concept per note
- NO hyperbolic language or marketing claims
- PRESERVE existing graph structure when updating
- INCREMENT version and note count in metadata
- ALL notes go in repository root (no subdirectories)

**Quality checks before writing:**
- Is this truly atomic (one concept)?
- Is it complete enough to stand alone?
- Are relationships meaningful and justified?
- Do tags span multiple dimensions?
- Is content technical and specific?

Execute these steps for the topic provided by the user.
